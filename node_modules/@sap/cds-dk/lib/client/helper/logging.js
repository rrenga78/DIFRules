/* eslint-disable no-console */

function getMessage(errorText, { error, command, help = command && getCommandHelp(command) } = {}) {
    let message = errorText ? errorText : '';
    if (error) {
        message += '\n' + (
            error.response?.data?.message           // response body == error
            || error.response?.data?.error?.message // response body == { error }
            || error.message                        // no response attached
        );
        if (error.stack && require('../../cds').debug('cli')) {
            message += '\n' + error.stack;
        }
    }
    if (typeof help === 'string') {
        message += require('../../../bin/help').formatHelp(help);
    }
    return message;
}

function getCommandHelp(command) {
    const cli = require('../../../bin/cds');
    return cli?.load(command, () => ({ help: '' }))?.help ?? '';
}

module.exports = {
    getMessage
};
