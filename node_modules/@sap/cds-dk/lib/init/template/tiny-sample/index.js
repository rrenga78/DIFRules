const { join } = require('path')
const cds = require('../../../../lib/cds'), { copy } = cds.utils
const { renderAndCopy } = require('../../util/template')
const mvn = require('../../util/mvn')
const { readProject } = require('../../util/projectReader')
const { JAVA } = require('../../constants')

module.exports = class TinySampleTemplate extends require('../templateBase') {

    async run() {
        const { isJava } = await readProject()
        if (isJava) {
            if (!cds.cli.options.add.has(JAVA)) {
                await mvn.execMvn(mvn.getAddSamplesCmdArgs())
                await mvn.execMvn(mvn.getAddTestsCmdArgs())
            }
        } else {
            const { db, srv } = (await this.getEnv()).folders
            await Promise.all([
                copy(join(__dirname, 'files', 'nodejs', 'db')).to(db),
                renderAndCopy(join(__dirname, 'files', 'nodejs', 'srv'), srv, { dbFolder: db.replace(/[\\/]+$/, '') })
            ])
        }
    }
}
